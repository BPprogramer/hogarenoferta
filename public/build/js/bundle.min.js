!function(){if(document.querySelector("#clientes")){let a,n=null;const r=document.querySelector("#registrar"),c=document.querySelector("#clienteForm"),i=document.querySelector("#nombre"),l=document.querySelector("#cedula"),s=document.querySelector("#celular"),d=document.querySelector("#direccion"),u=document.querySelector("#email");function e(){c.reset(),btnSubmit.disabled=!1,$("#modal-cliente").modal("show"),o(),n&&async function(){try{const e=await fetch("/api/cliente?id="+n);!function(e){i.value=e.nombre,l.value=e.cedula,s.value=e.celular,d.value=e.direccion,u.value=e.email}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;n&&e.append("id",n),e.append("nombre",i.value.trim()),e.append("cedula",l.value),e.append("celular",s.value),e.append("direccion",d.value.trim()),e.append("email",u.value.trim()),btnSubmit.disabled=!0;let o="";o=n?location.origin+"/api/cliente/editar":location.origin+"/api/cliente/crear";try{const n=await fetch(o,{body:e,method:"POST"}),r=await n.json();t(),btnSubmit.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):(a.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),c.reset(),$("#modal-cliente").modal("hide"))}catch(e){}}()}}),$("#clienteForm").validate({rules:{nombre:{required:!0,minlength:6},cedula:{digits:!0,minlength:6},celular:{digits:!0,rangelength:[10,10]},email:{email:!0}},messages:{nombre:{required:"El nombre es obligatorio",minlength:"Debe tener al menos 6 caracteres"},cedula:{digits:"Solo valores númericos",minlength:"Debe tener al menos 6 numeros"},celular:{digits:"solo valores numericos",rangelength:"Debe contener 10 números"},email:{email:"el email no es valido"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}$("#tabla").dataTable().fnDestroy(),a=$("#tabla").DataTable({ajax:"/api/clientes",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),r.addEventListener("click",(function(){n=null,e()})),$("#tabla").on("click","#editar",(function(t){n=t.currentTarget.dataset.clienteId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const n=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al Cliente <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/cliente/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),n=await e.json();t(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{t()},8e3),a.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.clienteId,e)})),$("#clienteForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#categorias")){let a,n=null;const r=document.querySelector("#registrar"),c=document.querySelector("#categoriaForm"),i=document.querySelector("#categoria");function e(){c.reset(),btnSubmit.disabled=!1,$("#modal-categoria").modal("show"),o(),n&&async function(){try{const e=await fetch("/api/categoria?id="+n);!function(e){i.value=e.categoria}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;n&&e.append("id",n),e.append("categoria",i.value.trim()),btnSubmit.disabled=!0;let o="";o=n?location.origin+"/api/categoria/editar":location.origin+"/api/categoria/crear";try{const n=await fetch(o,{body:e,method:"POST"}),r=await n.json();t(),btnSubmit.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):(a.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),c.reset(),$("#modal-categoria").modal("hide"))}catch(e){}}()}}),$("#categoriaForm").validate({rules:{categoria:{required:!0}},messages:{categoria:{required:"El nombre de la categoría es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}$("#tabla").dataTable().fnDestroy(),a=$("#tabla").DataTable({ajax:"/api/categorias",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),i.addEventListener("input",(function(e){i.value=e.target.value.toUpperCase()})),r.addEventListener("click",(function(){n=null,e()})),$("#tabla").on("click","#editar",(function(t){n=t.currentTarget.dataset.categoriaId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const n=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar la categoría <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/categoria/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),n=await e.json();t(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{t()},8e3),a.ajax.reload())}catch(e){$(document).Toasts("create",{class:"bg-danger",title:"Error",body:"No es Posible eliminar la cateogoría porque tiene productos  asociados"}),setTimeout(()=>{t()},8e3)}}(e)})}(e.currentTarget.dataset.categoriaId,e)})),$("#categoriaForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#cajas")){const a=document.querySelector("#registrar"),n=document.querySelector("#cajaForm"),r=document.querySelector("#btnSubmit");let c,i;const l=document.querySelector("#efectivo-apertura");function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function t(){n.reset(),r.disabled=!1,$("#modal-caja").modal("show"),$("#cajaForm").validate().resetForm(),$("#cajaForm").validate().destroy(),$("#cajaForm").find(".is-invalid").removeClass("is-invalid"),i&&async function(){try{const e=await fetch("/api/caja?id="+i);!function(e){l.value=parseFloat(e).toLocaleString("en")}(await e.json())}catch(e){console.log(e)}}(),o()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;i&&t.append("id",i),t.append("efectivo_apertura",l.value),r.disabled=!0;let o="";o=i?location.origin+"/api/caja/editar":location.origin+"/api/caja/crear";try{const a=await fetch(o,{body:t,method:"POST"}),i=await a.json();e(),r.disabled=!1,"error"==i.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:i.msg}),$("#modal-caja").modal("hide")):(c.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:i.msg}),n.reset(),$("#modal-caja").modal("hide")),setTimeout(()=>{e()},4e3)}catch(e){}}()}}),$("#cajaForm").validate({rules:{efectivo_apertura:{required:!0}},messages:{efectivo_apertura:{required:"El campo es obligatorio, si el efectivo inicial es cero porfavor digite 0"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}l.addEventListener("input",(function(e){l.value=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(e.target.value)})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/cajas",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),a.addEventListener("click",(function(){i=null,t()})),$("#tabla").on("click","#editar",(function(e){i=e.currentTarget.dataset.cajaId,t()})),$("#tabla").on("click","#eliminar",(function(t){!function(t,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[2].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar esta caja la cual tiene una efectivo de apertura de  <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/caja/eliminar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.cajaId,t)})),$("#tabla").on("click","#cerrar",(function(t){!function(t,o){Swal.fire({icon:"warning",html:'<h2 class="">¿Está seguro de cerrar esta caja? </h2><br><p>Esta acción no se puede deshacer</p>',showCancelButton:!0,confirmButtonText:"Cerrar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/caja/cerrar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.cajaId)})),$("#cajaForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#seccion-fiados")){const e=document.querySelector("#selectClientes");!async function(){try{const t=await fetch(location.origin+"/api/clientes-ventas-fiadas"),o=await t.json(),a=document.createElement("OPTION");a.textContent="--seleccione un cliente--",a.value="0",e.appendChild(a),o.forEach(t=>{const o=document.createElement("OPTION");o.value=t.id,o.textContent=t.nombre,e.appendChild(o)}),$("#selectClientes").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}catch(e){console.log(e)}$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}()}}(),function(){if(document.querySelector("#seccion-fiados")){let c={monto:0,deuda:0,saldo:0,venta_id:""},i=[],l="";const s=document.querySelector("#btnSubmitPago"),d=document.querySelector("#body-fiados"),u=document.querySelector("#total-deuda"),m=(document.querySelector("#pagar"),document.querySelector("#pagoForm")),p=document.querySelector("#deuda-actual"),g=document.querySelector("#pagar-todo"),f=document.querySelector("#monto"),v=document.querySelector("#saldo-restante");async function e(){if(!!(c.saldo<0))return void Swal.fire({icon:"warning",text:"El monto a pagar no puede superar el valor de la deuda"});const e=new FormData;e.append("venta_id",c.venta_id),e.append("monto",c.monto),s.disabled=!0;const t=location.origin+"/api/pagar";try{const o=await fetch(t,{method:"POST",body:e}),n=await o.json();s.disabled=!1,$("#modal-pago").modal("hide"),r(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),a(l)),setTimeout(()=>{r()},8e3)}catch(e){}}function t(){c.saldo=c.deuda-c.monto,isNaN(c.saldo)&&(c.saldo=c.deuda),v.textContent="$"+parseFloat(c.saldo).toLocaleString("en")}function o(){m.reset(),s.disabled=!1,console.log(c),p.value=parseFloat(c.deuda).toLocaleString("en"),v.textContent="$"+parseFloat(c.saldo).toLocaleString("en"),$.validator.setDefaults({submitHandler:function(){e()}}),$("#pagoForm").validate({rules:{monto:{required:!0,customValidation:"0"}},messages:{monto:{required:"El monto a pagar es obligatorio",customValidation:'El monto no puede ser igual a "0"'}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}}),$.validator.addMethod("customValidation",(function(e,t){return function(e,t,o){return e!==o}(e,0,"0")}),'Este campo no puede ser igual a "0"')}async function a(e){l=e;try{v.textContent="$0";const t=await fetch(`${location.origin}/api/pagos-cuotas?id=${e}`),s=await t.json();if(n(d),0==s.ventas_fiadas.length)Swal.fire({icon:"warning",text:"No hay fiados para este cliente"}),u.textContent=0,c.deuda=0,c.monto=0,c.saldo=0;else{const{ventas_fiadas:e}=s;!function(e){let t=0;e.forEach(e=>{const{codigo:s,total_factura:u,recaudo:m,pagado:p}=e;0!=p&&i.push();const g=document.createElement("TR"),f=document.createElement("TD");f.textContent="#"+s;const v=document.createElement("TD");v.textContent="$"+parseFloat(u).toLocaleString("en");const b=document.createElement("TD");b.textContent="$"+parseFloat(m).toLocaleString("en");const h=document.createElement("TD");h.textContent="$"+parseFloat(u-m).toLocaleString("en");const y=document.createElement("TD"),S=document.createElement("DIV");S.classList.add("d-flex","justify-content-left","text-center");const C=document.createElement("BUTTON");C.type="button",C.classList.add("btn","w-40","btn-inline","btn-sm"),0==p?(t=t+parseFloat(u)-parseFloat(m),C.textContent="Pendiente",C.classList.add("btn-danger")):(C.textContent="Pagado",C.classList.add("bg-azul","text-white")),S.appendChild(C),y.appendChild(S);const T=document.createElement("TD"),_=document.createElement("DIV");_.classList.add("d-flex","justify-content-start");const q=document.createElement("BUTTON");q.type="button",q.classList.add("btn","btn-sm","bg-hover-azul","text-white","toolMio","mr-2"),q.innerHTML='<span class="toolMio-text">Ver venta</span><i class="fas fa-search"></i>';const E=document.createElement("BUTTON");E.type="button",E.classList.add("btn","btn-sm","bg-hover-azul","text-white","toolMio","mr-2"),E.innerHTML='<span class="toolMio-text">Pagos</span><i class="fas fa-money-bill-wave"></i>  ';const x=document.createElement("BUTTON");x.type="button",x.classList.add("btn","btn-sm","bg-hover-azul","text-white","toolMio"),x.innerHTML='<span class="toolMio-text">Pagar</span><i class="fas fa-coins"></i>  ',q.onclick=()=>{!async function(e){$("#modal-info").modal("show");try{const t=await fetch(`${location.origin}/api/productos-fiados?venta_id=${e.id}`),o=await t.json();"error"==o.type?Swal.fire({icon:"error",text:o.msg}):function(e,t){const o=document.querySelector("#codigo-venta"),a=document.querySelector("#cliente-venta"),r=document.querySelector("#fecha-venta"),c=document.querySelector("#total-venta"),i=document.querySelector("#recaudo-venta"),l=document.querySelector("#saldo-venta");o.textContent=e.codigo,a.textContent=e.nombre_cliente,r.textContent=e.fecha,c.textContent=parseFloat(e.total).toLocaleString("en"),i.textContent=parseFloat(e.recaudo).toLocaleString("en"),l.textContent=parseFloat(e.total-e.recaudo).toLocaleString("en");const s=document.querySelector("#body-productos-fiados");n(s),t.forEach(e=>{const{nombre:t,cantidad:o,precio:a}=e,n=document.createElement("TR"),r=document.createElement("td");r.textContent=t;const c=document.createElement("td");c.textContent=o;const i=document.createElement("td");i.textContent=parseFloat(a).toLocaleString("en");const l=document.createElement("td");l.textContent=parseFloat(a*o).toLocaleString("en"),n.appendChild(r),n.appendChild(c),n.appendChild(i),n.appendChild(l),s.appendChild(n)})}(e,o)}catch(e){}}(e)},E.onclick=()=>{!async function(e){try{const t=await fetch(`${location.origin}/api/pagos-por-venta?venta_id=${e.id}`),o=await t.json();"error"==o.type?Swal.fire({icon:"error",text:o.msg}):($("#modal-pagos").modal("show"),function(e,t){const o=document.querySelector("#body-pagos");n(o),t.forEach(e=>{const{payment_number:t,date:n,payment_amount:c,responsible:i,remaining_balance:s}=e,d=document.createElement("TR"),u=document.createElement("TD");u.textContent="#"+t;const m=document.createElement("TD");m.textContent=n;const p=document.createElement("TD");p.textContent=i.nombre;const g=document.createElement("TD");g.textContent="$"+parseFloat(c).toLocaleString("en");const f=document.createElement("TD");f.textContent="$"+parseFloat(s).toLocaleString("en");const v=document.createElement("TD"),b=document.createElement("DIV");b.classList.add("d-flex","ustify-content-start");const h=document.createElement("BUTTON");h.type="button",h.classList.add("btn","btn-sm","bg-hover-azul","text-white","toolMio"),h.innerHTML='<span class="toolMio-text">Eliminar</span><i class="fas fa-trash"></i>',h.onclick=function(){!function(e){Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el pago número ${e.payment_number} por un valor de <span class="font-weight-bold"> ${parseFloat(e.payment_amount).toLocaleString("en")} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(e){const t=new FormData;t.append("id",e.id);const o=location.origin+"/api/eliminar-pago";try{const e=await fetch(o,{method:"POST",body:t}),n=await e.json();r(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),$("#modal-pagos").modal("hide"),a(l)),setTimeout(()=>{r()},8e3)}catch(e){}}(e)})}(e)},b.appendChild(h),v.appendChild(b),d.appendChild(u),d.appendChild(m),d.appendChild(p),d.appendChild(g),d.appendChild(f),d.appendChild(v),o.appendChild(d)})}(0,o.data))}catch(e){}}(e)},x.onclick=()=>{!async function(e){const{total_factura:t,recaudo:a,id:n,pagado:r}=e;1==r?Swal.fire({icon:"warning",text:"Esta venta ya se encuentra pagada en su totalidad"}):($("#modal-pago").modal("show"),c.deuda=t-a,c.saldo=t-a,c.venta_id=n,o())}(e)},_.appendChild(q),_.appendChild(E),_.appendChild(x),T.appendChild(_),g.appendChild(f),g.appendChild(v),g.appendChild(b),g.appendChild(h),g.appendChild(y),g.appendChild(T),d.appendChild(g),c.cliente_id=e.cliente_id}),u.textContent=parseFloat(t).toLocaleString("en"),c.deuda=t,c.saldo=t}(e)}}catch(e){console.log(e)}}function n(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function r(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}g.addEventListener("click",(function(){c.monto=c.deuda,f.value=parseFloat(c.monto).toLocaleString("en"),t()})),f.addEventListener("input",(function(e){const o=e.target.value;let a=parseFloat(o.replace(/,/g,""));""==a&&(a=0),c.monto=a,t();const n=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(o);f.value=n})),$("#selectClientes").on("select2:select",(function(e){0!=e.target.value&&a(e.target.value)}))}}(),function(){if(document.querySelector("#inicio")){const e=document.querySelector("#inicio_total_ventas"),t=document.querySelector("#inicio_total_recaudos"),o=document.querySelector("#inicio_costos"),a=document.querySelector("#inicio_ganancia_no_realizada"),n=document.querySelector("#inicio_ganancia_realizada"),r=document.querySelector("#inicio_inventario"),c=document.querySelector("#inicio_numero_ventas"),i=document.querySelector("#inicio_numero_fiados"),l=document.querySelector("#inicio_numero_pagos"),s=document.querySelector("#inicio_numero_cajas"),d=document.querySelector("#inicio_numero_productos"),u=document.querySelector("#inicio_numero_clientes");!async function(){const m=location.origin+"/api/inicio";try{const p=await fetch(m);!function(m){e.textContent=m.total_ventas,t.textContent=m.total_recaudos,o.textContent=m.costos,a.textContent=m.ganancia_no_realizada,n.textContent=m.ganancia_realizada,r.textContent=m.inventario,c.textContent=m.numero_ventas,i.textContent=m.numero_fiados,l.textContent=m.numero_pagos,s.textContent=m.numero_cajas,d.textContent=m.numero_productos,u.textContent=m.numero_clientes}(await p.json())}catch(e){console.log(e)}}()}}(),function(){if(document.querySelector("#mercadolibre")){$("#tabla").on("click","#info",(function(e){!async function(e){$("#modal-info").modal("show");const t=`${location.origin}/api/venta?id=${e}`;try{const e=await fetch(t);!function(e){const{productos_venta:t,venta:o}=e,a=document.querySelector("#codigo-venta"),n=document.querySelector("#cliente-venta"),r=document.querySelector("#fecha-venta"),c=document.querySelector("#total-venta"),i=document.querySelector("#total-sin-comision"),l=document.querySelector("#recaudo-venta"),s=document.querySelector("#saldo-venta"),d=document.querySelector("#metodo-venta"),u=document.querySelector("#estado-venta");a.textContent=o.codigo,n.textContent=o.nombre_cliente,r.textContent=o.fecha,c.textContent=parseFloat(o.total_factura).toLocaleString("en"),i.textContent=parseFloat(o.total).toLocaleString("en"),l.textContent=parseFloat(o.recaudo).toLocaleString("en"),s.textContent=parseFloat(o.total_factura-o.recaudo).toLocaleString("en"),2==o.metodo_pago&&(d.textContent="Fiado");3==o.metodo_pago&&(d.textContent="Mercado Libre");1==o.metodo_pago&&(d.textContent="De Contado");u.classList.contains("text-danger")&&u.classList.remove("text-danger");u.classList.contains("text-success")&&u.classList.remove("text-success");0==o.estado?(u.textContent="Pendiente",u.classList.add("text-danger")):(u.textContent="Pagado",u.classList.add("text-success"));const m=document.querySelector("#body-productos-venta");(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})(m),t.forEach(e=>{const{nombre:t,cantidad:o,precio:a}=e,n=document.createElement("TR"),r=document.createElement("td");r.textContent=t;const c=document.createElement("td");c.textContent=o;const i=document.createElement("td");i.textContent=parseFloat(a).toLocaleString("en");const l=document.createElement("td");l.textContent=parseFloat(a*o).toLocaleString("en"),n.appendChild(r),n.appendChild(c),n.appendChild(i),n.appendChild(l),m.appendChild(n)})}(await e.json())}catch(e){}}(e.currentTarget.dataset.ventaId)}))}}(),function(){if(document.querySelector("#mercadolibre")){let e;!async function(){try{await fetch(location.origin+"/api/pagos-auto")}catch(e){}}(),$("#tabla").dataTable().fnDestroy(),e=$("#tabla").DataTable({ajax:"/api/mercadolibre",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(e,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}})}}(),function(){if(document.querySelector("#proveedores")){let a,n=null;const r=document.querySelector("#registrar"),c=document.querySelector("#proveedorForm"),i=document.querySelector("#nombre"),l=(document.querySelector("#cedula"),document.querySelector("#celular")),s=document.querySelector("#direccion");document.querySelector("#email");function e(){c.reset(),btnSubmit.disabled=!1,$("#modal-proveedor").modal("show"),o(),n&&async function(){try{const e=await fetch("/api/proveedor?id="+n);!function(e){i.value=e.nombre,l.value=e.celular,s.value=e.direccion}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;n&&e.append("id",n),e.append("nombre",i.value.trim()),e.append("celular",l.value),e.append("direccion",s.value.trim()),btnSubmit.disabled=!0;let o="";o=n?location.origin+"/api/proveedor/editar":location.origin+"/api/proveedor/crear";try{const n=await fetch(o,{body:e,method:"POST"}),r=await n.json();t(),btnSubmit.disabled=!1,"error"==r.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}),setTimeout(()=>{t()},0)):(a.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),c.reset(),$("#modal-proveedor").modal("hide"))}catch(e){console.log("error")}}()}}),$("#proveedorForm").validate({rules:{nombre:{required:!0,minlength:2},celular:{digits:!0,rangelength:[10,10]}},messages:{nombre:{required:"El nombre es obligatorio",minlength:"Debe tener al menos 2 caracteres"},celular:{digits:"Solo valores númericos",rangelength:"el número de celular debe tener 10 digitos"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}a=$("#tabla").DataTable({ajax:"/api/proveedores",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),i.addEventListener("input",(function(e){i.value=e.target.value.toUpperCase()})),r.addEventListener("click",(function(){n=null,e()})),$("#tabla").on("click","#editar",(function(t){n=t.currentTarget.dataset.proveedorId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const n=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al Proveedor <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/proveedor/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),n=await e.json();t(),"error"==n.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}),setTimeout(()=>{t()},4e3)):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{t()},8e3),a.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.proveedorId,e)})),$("#proveedorForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#pagos")){let e;$("#tabla").dataTable().fnDestroy(),e=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/pagos",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0})}}(),function(){if(document.querySelector("#compras")){const n=document.querySelector("#stockForm"),r=document.querySelector("#nombre_producto"),c=document.querySelector("#nuevo_stock"),i=document.querySelector("#precio_paquete_nuevo"),l=document.querySelector("#unidades_nuevo"),s=document.querySelector("#precio_compra_nuevo"),d=document.querySelector("#btnSubmitNewStock");function e(){s.value="";const e=parseFloat(i.value.replace(/,/g,"")),t=parseFloat(l.value);if(isNaN(e)||isNaN(t))return;const o=e/t;s.value=Math.round(o).toLocaleString("en")}function t(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}function o(e){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;e.append("id",idProductoActualizarStock),e.append("stock",c.value),e.append("precio_compra",s.value),d.disabled=!0;const t=location.origin+"/api/producto/editar-stock";try{const o=await fetch(t,{body:e,method:"POST"}),r=await o.json();a(),d.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):($("#tabla").DataTable().ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{a()},4e3),n.reset(),$("#modal-stock").modal("hide"))}catch(e){}}()}}),$("#stockForm").validate({rules:{nuevo_stock:{required:!0},precio_compra_nuevo:{required:!0}},messages:{nuevo_stock:{required:"El nombre es obligatorio"},precio_compra_nuevo:{required:"la nueva cantidad adquirida es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function a(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}$("#tabla").dataTable().fnDestroy(),tablaCompras=$("#tabla").DataTable({ajax:"/api/compras",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(tablaCompras,{buttons:["copy","csv","excel","pdf","print","colvis"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),$("#tabla").on("click","#agregar_stock",(function(e){idProductoActualizarStock=e.currentTarget.dataset.productoId,n.reset(),d.disabled=!1,$("#modal-stock").modal("show"),$("#stockForm").validate().resetForm(),$("#stockForm").validate().destroy(),$("#stockForm").find(".is-invalid").removeClass("is-invalid");const t=e.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;r.value=t,o()})),i.addEventListener("input",(function(o){const a=t(o.target.value);i.value=a,e()})),l.addEventListener("input",(function(t){e()})),s.addEventListener("input",(function(e){const o=t(e.target.value);s.value=o})),$("#stockForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#productos")){const a=document.querySelector("#precio_compra"),n=document.querySelector("#precio_venta"),r=document.querySelector("#porcentaje_venta"),c=document.querySelector("#precio_paquete"),i=document.querySelector("#unidades");function e(){a.value="",n.value="",r.value="";const e=parseFloat(c.value.replace(/,/g,"")),t=parseFloat(i.value);if(isNaN(e)||isNaN(t))return;const o=e/t;a.value=Math.round(o).toLocaleString("en")}function t(){const e=parseFloat(a.value.replace(/,/g,"")),t=parseFloat(n.value.replace(/,/g,""));if(isNaN(e)||isNaN(t))return;const o=100*(t-e)/e;r.value=o.toFixed(2)}function o(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}a.addEventListener("input",(function(e){const n=o(e.target.value);a.value=n,t()})),n.addEventListener("input",(function(e){const a=o(e.target.value);n.value=a,t()})),r.addEventListener("input",(function(e){!function(e){const t=parseFloat(a.value.replace(/,/g,""));if(isNaN(t))return;const o=t+t*parseFloat(e)/100;n.value=(100*Math.round(o/100)).toLocaleString("en")}(e.target.value)})),c.addEventListener("input",(function(t){const a=o(t.target.value);c.value=a,e()})),i.addEventListener("input",(function(t){e()}))}}(),function(){if(document.querySelector("#productos")){const c=document.querySelector("#registrar"),i=document.querySelector("#productoForm"),l=document.querySelector("#categoria_id"),s=document.querySelector("#proveedor_id");let d,u,m=null,p=null;const g=document.querySelector("#nombre"),f=document.querySelector("#codigo"),v=document.querySelector("#categoria_id"),b=document.querySelector("#proveedor_id"),h=document.querySelector("#stock"),y=document.querySelector("#stock_minimo"),S=document.querySelector("#precio_compra"),C=document.querySelector("#precio_venta"),T=document.querySelector("#porcentaje_venta"),_=document.querySelector("#btnSubmit");async function e(){try{const e=await fetch("/api/productos-categorias");!function(e){r(l),e.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.categoria,e.id==m&&(t.selected=!0),l.appendChild(t)})}(await e.json())}catch(e){}}async function t(){try{const e=await fetch("/api/productos-proveedores");!function(e){r(s),e.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.nombre,e.id==p&&(t.selected=!0),s.appendChild(t)}),$(".selectCategoria").select2(),$(".selectProveedor").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}(await e.json())}catch(e){}}function o(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function a(){i.reset(),_.disabled=!1,$("#modal-producto").modal("show"),$("#productoForm").validate().resetForm(),$("#productoForm").validate().destroy(),$("#productoForm").find(".is-invalid").removeClass("is-invalid"),u&&async function(){try{const e=await fetch("/api/producto?id="+u);!function(e){m=e.categoria_id,p=e.proveedor_id,g.value=e.nombre.toUpperCase(),f.value=e.codigo,h.value=e.stock,y.value=e.stock_minimo,S.value=parseFloat(e.precio_compra).toLocaleString("en"),C.value=parseFloat(e.precio_venta).toLocaleString("en"),T.value=e.porcentaje_venta}(await e.json())}catch(e){console.log(e)}}(),await e(),await t(),n()}function n(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;u&&e.append("id",u),e.append("nombre",g.value.trim()),e.append("codigo",f.value.trim()),e.append("categoria_id",v.value),e.append("proveedor_id",b.value),e.append("stock",h.value),e.append("stock_minimo",y.value),e.append("precio_compra",S.value),e.append("precio_venta",C.value),e.append("porcentaje_venta",T.value),_.disabled=!0;let t="";t=u?location.origin+"/api/producto/editar":location.origin+"/api/producto/crear";try{const a=await fetch(t,{body:e,method:"POST"}),n=await a.json();o(),_.disabled=!1,"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):(d.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{o()},4e3),i.reset(),$("#modal-producto").modal("hide"))}catch(e){}}()}}),$("#productoForm").validate({rules:{nombre:{required:!0},stock:{required:!0},stock_minimo:{required:!0},precio_compra:{required:!0},precio_venta:{required:!0},porcentaje_venta:{required:!0}},messages:{nombre:{required:"El nombre es obligatorio"},stock:{required:"El stock inicial es obligatorio"},stock_minimo:{required:"El Stock mínimo es obligatorio"},precio_compra:{required:"El precio de compra es obligatorio"},precio_venta:{required:"El precio de venta es obligatorio"},porcentaje_venta:{required:"El porcentaje de venta es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function r(e){for(;e.firstChild;)e.removeChild(e.firstChild)}_.addEventListener("click",(function(){})),function(){$.fn.DataTable.isDataTable("#tabla")&&$("#tabla").DataTable().destroy();d=$("#tabla").DataTable({processing:!0,serverSide:!0,ajax:{url:"/api/productos",type:"GET"},responsive:!0,order:[[1,"desc"]],language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 a 0 de 0 Entradas",infoFiltered:"(filtrado de _MAX_ entradas totales)",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"}}})}(),g.addEventListener("input",(function(e){g.value=e.target.value.toUpperCase()})),c.addEventListener("click",(function(){u=null,m=null,p=null,a()})),$("#tabla").on("click","#editar",(function(e){u=e.currentTarget.dataset.productoId,a()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,t){const a=t.currentTarget.parentElement.parentElement.parentElement.childNodes[2].textContent;console.log(a),Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el producto <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(e){const t=new FormData;t.append("id",e),url=location.origin+"/api/producto/eliminar";try{const e=await fetch(url,{body:t,method:"POST"}),a=await e.json();o(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),setTimeout(()=>{o()},8e3),d.ajax.reload())}catch(e){}}(e)})}(e.currentTarget.dataset.productoId,e)})),$("#productoForm").on("valid",(function(e){n()}))}}(),function(){if(document.querySelector("#productos")){const n=document.querySelector("#stockForm"),r=document.querySelector("#nombre_producto"),c=document.querySelector("#nuevo_stock"),i=document.querySelector("#precio_paquete_nuevo"),l=document.querySelector("#unidades_nuevo"),s=document.querySelector("#precio_compra_nuevo"),d=document.querySelector("#btnSubmitNewStock");let u;function e(){s.value="";const e=parseFloat(i.value.replace(/,/g,"")),t=parseFloat(l.value);if(isNaN(e)||isNaN(t))return;const o=e/t;s.value=Math.round(o).toLocaleString("en")}function t(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}function o(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function a(e){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;e.append("id",u),e.append("stock",c.value),e.append("precio_compra",s.value),d.disabled=!0;const t=location.origin+"/api/producto/editar-stock";try{const a=await fetch(t,{body:e,method:"POST"}),r=await a.json();o(),d.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):($("#tabla").DataTable().ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:r.msg}),setTimeout(()=>{o()},4e3),n.reset(),$("#modal-stock").modal("hide"))}catch(e){}}()}}),$("#stockForm").validate({rules:{nuevo_stock:{required:!0},precio_compra_nuevo:{required:!0}},messages:{nuevo_stock:{required:"El nombre es obligatorio"},precio_compra_nuevo:{required:"la nueva cantidad adquirida es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}$("#tabla").on("click","#agregar_stock",(function(e){u=e.currentTarget.dataset.productoId,n.reset(),d.disabled=!1,$("#modal-stock").modal("show"),$("#stockForm").validate().resetForm(),$("#stockForm").validate().destroy(),$("#stockForm").find(".is-invalid").removeClass("is-invalid");const t=e.currentTarget.parentElement.parentElement.parentElement.childNodes[2].textContent;r.value=t,a()})),i.addEventListener("input",(function(o){const a=t(o.target.value);i.value=a,e()})),l.addEventListener("input",(function(t){e()})),s.addEventListener("input",(function(e){const o=t(e.target.value);s.value=o})),$("#stockForm").on("valid",(function(e){a()}))}}(),function(){if(document.querySelector("#productos-vendidos")){let a;const n=document.querySelector("#fecha-inicial"),r=document.querySelector("#fecha-final"),c=new Date;let i=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2);c.setMonth(c.getMonth()-1);let l=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2);function e(){if(new Date(l)>=new Date(i))Swal.fire({icon:"error",title:"Error",text:"La fecha inicial debe ser menor que la fecha final"});else{const e=new FormData;e.append("fecha_inicial",l),e.append("fecha_final",i),$("#tabla").dataTable().fnDestroy(),a=$("#tabla").DataTable({ajax:{url:`${location.origin}/api/productos-vendidos?fecha-inicial=${l}&fecha-final=${i}`,dataFilter:function(e){const t=JSON.parse(e);let o=[];const a=t.data;return console.log(a),a.forEach((function(e,t){e[1],parseInt(e[4]);if(o.length>0){let t=!1;o.forEach((a,n)=>{a[1]==e[1]&&(o[n][4]=parseInt(o[n][4])+parseInt(e[4]),o[n][6]=parseInt(o[n][4])*parseInt(o[n][5]),t=!0)}),0==t&&o.push(e)}else o.push(e)})),console.log(o),JSON.stringify({data:o})}},deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(a,{buttons:["copy","csv","excel","pdf","print","colvis"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),$.ajax({url:`${location.origin}/api/productos-vendidos?fecha-inicial=${l}&fecha-final=${i}`,dataType:"json",success:function(e){console.log(e)},error:function(e){console.log(e.resposeText)}})}}function t(e){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;e.append("id",idProductoActualizarStock),e.append("stock",nuevo_stock.value),e.append("precio_compra",precio_compra_nuevo.value),btnSubmitNewStock.disabled=!0;const t=location.origin+"/api/producto/editar-stock";try{const a=await fetch(t,{body:e,method:"POST"}),n=await a.json();o(),btnSubmitNewStock.disabled=!1,"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($("#tabla").DataTable().ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{o()},4e3),formularioStock.reset(),$("#modal-stock").modal("hide"))}catch(e){}}()}}),$("#stockForm").validate({rules:{nuevo_stock:{required:!0},precio_compra_nuevo:{required:!0}},messages:{nuevo_stock:{required:"El nombre es obligatorio"},precio_compra_nuevo:{required:"la nueva cantidad adquirida es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function o(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}n.value=l,r.value=i,e(),document.addEventListener("DOMContentLoaded",(function(){n.addEventListener("change",(function(){i=r.value,l=n.value,e()})),r.addEventListener("change",(function(){i=r.value,l=n.value,e()}))})),$("#stockForm").on("valid",(function(e){t()}))}}(),function(){if(document.querySelector("#loginForm")){const o=document.querySelector("#email"),a=document.querySelector("#password"),n=document.querySelector("#btnSubmit");async function e(){n.disabled=!0;const e=new FormData;e.append("email",o.value.trim()),e.append("password",a.value);try{const t="/api/usuario/login",o=await fetch(t,{body:e,method:"POST"}),a=await o.json();document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove(),"error"==a.type?(n.disabled=!1,$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg})):window.location.href="/inicio"}catch(e){}}function t(){$.validator.setDefaults({submitHandler:function(){e()}}),$("#loginForm").validate({rules:{email:{required:!0},password:{required:!0}},messages:{email:{required:"El usuario es obligatorio"},password:{required:"El password es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}t(),$("#loginForm").on("valid",(function(e){t()}))}}(),function(){if(document.querySelector("#usuarios")){let n,r=null;const c=document.querySelector("#registrar"),i=document.querySelector("#usuarioForm"),l=document.querySelector("#btnSubmit"),s=document.querySelector("#nombre"),d=document.querySelector("#email"),u=document.querySelector("#estado"),m=document.querySelector("#roll"),p=document.querySelector("#password");function e(){$("#usuarioForm").validate().destroy(),i.reset(),l.disabled=!1,o(u),o(m);const e=document.createElement("OPTION");e.setAttribute("disabled","disabled"),e.setAttribute("selected","selected"),e.textContent="--Seleccione--";const t=document.createElement("OPTION");t.value=0,t.textContent="Inactivo";const n=document.createElement("OPTION");n.value=1,n.textContent="Activo";const c=document.createElement("OPTION");c.setAttribute("disabled","disabled"),c.setAttribute("selected","selected"),c.textContent="--Seleccione--";const p=document.createElement("OPTION");p.value=0,p.textContent="Vendedor";const g=document.createElement("OPTION");g.value=1,g.textContent="Administrador",u.appendChild(e),u.appendChild(t),u.appendChild(n),m.appendChild(c),m.appendChild(p),m.appendChild(g),$("#modal-usuario").modal("show"),a(),r&&async function(){try{const e=await fetch("/api/usuario?id="+r);!function(e){s.value=e.nombre,d.value=e.email;u.querySelector('option[value="'+e.estado+'"]').setAttribute("selected","selected");m.querySelector('option[value="'+e.roll+'"]').setAttribute("selected","selected")}(await e.json())}catch(e){console.log(e)}}()}function t(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function o(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function a(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;r&&e.append("id",r),e.append("nombre",s.value.trim()),e.append("email",d.value),e.append("estado",u.value),e.append("roll",m.value),e.append("password",p.value),l.disabled=!0;let o="";o=r?location.origin+"/api/usuario/editar":location.origin+"/api/usuario/crear";try{const a=await fetch(o,{body:e,method:"POST"}),r=await a.json();console.log(r),l.disabled=!1,t(),l.disabled=!1,"error"==r.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg}):($(document).Toasts("create",{class:"bg-primary",title:"Completado",body:r.msg}),setTimeout(()=>{t()},4e3),i.reset(),$("#modal-usuario").modal("hide"),n.ajax.reload())}catch(e){}}()}});let e={},o={};r||(e={required:!0,minlength:6},o={required:"El password es obligatorio",minlength:"El Password debe tener al menos 6 caracteres"}),$("#usuarioForm").validate({rules:{nombre:{required:!0},email:{required:!0},estado:{required:!0},roll:{required:!0},password:e,terms:{required:!0}},messages:{nombre:{required:"El nombre es obligatorio"},email:{required:"El Usuario es obligatorio"},estado:{required:"el estado es obligatorio"},roll:{required:"el Roll es obligatorio"},password:o},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}c.addEventListener("click",(function(){r=null,e()})),s.addEventListener("input",(function(e){s.value=e.target.value.toUpperCase()})),function(){$.fn.DataTable.isDataTable("#tabla")&&$("#tabla").DataTable().destroy();n=$("#tabla").DataTable({processing:!0,serverSide:!0,ajax:{url:"/api/usuarios",type:"GET"},responsive:!0})}(),$("#tabla").on("click","#editar",(function(t){r=t.currentTarget.dataset.usuarioId,e()})),$("#tabla").on("click","#eliminar",(function(e){!function(e,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al usuario <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=new FormData;o.append("id",e),url=location.origin+"/api/usuario/eliminar";try{const e=await fetch(url,{body:o,method:"POST"}),a=await e.json();t(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),setTimeout(()=>{t()},8e3),n.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.usuarioId,e)})),$("#usuarioForm").on("valid",(function(e){a()}))}}(),function(){if(document.querySelector("#egresos")){const a=document.querySelector("#registrar"),n=document.querySelector("#egresoForm"),r=document.querySelector("#btnSubmit");let c,i;const l=document.querySelector("#egreso"),s=document.querySelector("#descripcion");function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function t(){n.reset(),r.disabled=!1,$("#modal-egreso").modal("show"),$("#egresoForm").validate().resetForm(),$("#egresoForm").validate().destroy(),$("#egresoForm").find(".is-invalid").removeClass("is-invalid"),i&&async function(){try{const e=await fetch("/api/egreso?id="+i);!function(e){l.value=parseFloat(e.egreso).toLocaleString("en"),s.value=e.descripcion}(await e.json())}catch(e){console.log(e)}}(),o()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;i&&t.append("id",i),t.append("egreso",l.value),t.append("descripcion",s.value.trim()),r.disabled=!0;let o="";o=i?location.origin+"/api/egreso/editar":location.origin+"/api/egreso/crear";try{const a=await fetch(o,{body:t,method:"POST"}),i=await a.json();e(),r.disabled=!1,"error"==i.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:i.msg}),$("#modal-egreso").modal("hide")):(c.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:i.msg}),n.reset(),$("#modal-egreso").modal("hide")),setTimeout(()=>{e()},4e3)}catch(e){}}()}}),$("#egresoForm").validate({rules:{ingreso:{required:!0},descripcion:{required:!0}},messages:{ingreso:{required:"El monto que sale de la caja es obligatorio"},descripcion:{required:"La nota o descripción es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}l.addEventListener("input",(function(e){l.value=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(e.target.value)})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/egresos",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),$.ajax({url:"/api/egresos",dataType:"json",success:function(e){console.log(e)},error:function(e){console.log(e.resposeText)}}),a.addEventListener("click",(function(){i=null,t()})),$("#tabla").on("click","#editar",(function(e){i=e.currentTarget.dataset.egresoId,t()})),$("#tabla").on("click","#eliminar",(function(t){!function(t,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[3].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el egreso por un valor de <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/egreso/eliminar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.egresoId,t)})),$("#egresoForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#ingresos")){const a=document.querySelector("#registrar"),n=document.querySelector("#ingresoForm"),r=document.querySelector("#btnSubmit");let c,i;const l=document.querySelector("#ingreso"),s=document.querySelector("#descripcion");function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function t(){n.reset(),r.disabled=!1,$("#modal-ingreso").modal("show"),$("#ingresoForm").validate().resetForm(),$("#ingresoForm").validate().destroy(),$("#ingresoForm").find(".is-invalid").removeClass("is-invalid"),i&&async function(){try{const e=await fetch("/api/ingreso?id="+i);!function(e){l.value=parseFloat(e.ingreso).toLocaleString("en"),s.value=e.descripcion}(await e.json())}catch(e){console.log(e)}}(),o()}function o(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;i&&t.append("id",i),t.append("ingreso",l.value),t.append("descripcion",s.value),r.disabled=!0;let o="";o=i?location.origin+"/api/ingreso/editar":location.origin+"/api/ingreso/crear";try{const a=await fetch(o,{body:t,method:"POST"}),i=await a.json();e(),r.disabled=!1,"error"==i.type?($(document).Toasts("create",{class:"bg-danger",title:"Error",body:i.msg}),$("#modal-ingreso").modal("hide")):(c.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:i.msg}),n.reset(),$("#modal-ingreso").modal("hide")),setTimeout(()=>{e()},4e3)}catch(e){}}()}}),$("#ingresoForm").validate({rules:{ingreso:{required:!0},descripcion:{required:!0}},messages:{ingreso:{required:"El monto que ingresa en la caja es obligatorio"},descripcion:{required:"La nota o descripción es obligatoria"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}l.addEventListener("input",(function(e){l.value=function(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}(e.target.value)})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 to 0 of 0 Entradas",infoFiltered:"(Filtrado de _MAX_ total entradas)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},ajax:"/api/ingresos",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0}),$.ajax({url:"/api/ingresos",dataType:"json",success:function(e){},error:function(e){}}),a.addEventListener("click",(function(){i=null,t()})),$("#tabla").on("click","#editar",(function(e){i=e.currentTarget.dataset.ingresoId,t()})),$("#tabla").on("click","#eliminar",(function(t){!function(t,o){const a=o.currentTarget.parentElement.parentElement.parentElement.childNodes[3].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el ingreso por un valor de <span class="font-weight-bold"> ${a} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t),url=location.origin+"/api/ingreso/eliminar";try{const t=await fetch(url,{body:o,method:"POST"}),a=await t.json();e(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),c.ajax.reload()),setTimeout(()=>{e()},8e3)}catch(e){}}(t)})}(t.currentTarget.dataset.ingresoId,t)})),$("#ingresoForm").on("valid",(function(e){o()}))}}(),function(){if(document.querySelector("#seccion-crear-ventas")){let u,m,p,g=null,f={id:"",nombre:"",cantidad:"",precio_compra:"",precio_venta:"",precio_original:"",valor_total:"",stock:""},v={total_sin_descuento:"",total_pagar:"",descuento:"",costo:"",total_libre:""},b=!0,h=[];const y=document.querySelector("#selectClientes"),S=document.querySelector("#guardar-venta"),C=document.querySelector("#total"),T=document.querySelector("#descuento"),_=document.querySelector("#total_pagar"),q=document.querySelector("#metodo_pago"),E=document.querySelector("#pago-contado"),x=document.querySelector("#pago-cuotas"),w=document.querySelector("#cantidad_pagar"),L=document.querySelector("#cantidad_cambio"),F=document.querySelector("#abono"),D=document.querySelector("#saldo"),j=document.querySelector("#nombre_cliente"),k=document.querySelector("#cedula_cliente"),N=document.querySelector("#celular_cliente"),P=document.querySelector("#direccion_cliente"),O=document.querySelector("#email_cliente"),I=document.querySelector("#agregar-cliente"),R=document.querySelector("#quitar-cliente"),M=document.querySelector("#contenedorCliente"),z=document.querySelector("#codigo-venta"),B=document.querySelector("#codigo-producto"),A=document.querySelector("#selectProductos");async function e(){try{const e=await fetch(location.origin+"/api/codigo-venta"),t=await e.json();z.value=t}catch(e){}}async function t(e){try{const o=await fetch(`${location.origin}/api/cliente?id=${e}`),a=await o.json();s(),"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):(setTimeout(()=>{s()},4e3),t=a,j.value=t.nombre??"",k.value=t.cedula??"",N.value=t.celular??"",P.value=t.direccion??"",O.value=t.email??"")}catch(e){}var t}function o(){$("#selectClientes").val("0").trigger("change.select2"),j.value="",k.value="",N.value="",P.value="",O.value=""}function a(){const e=document.querySelector("#productosVenta");l(e),h.forEach(t=>{const{id:o,nombre:c,precio_venta:l,cantidad:s,valor_total:d,stock:u}=t,p=document.createElement("DIV");p.classList.add("row","px-2"),p.dataset.productoId=o;const g=document.createElement("DIV");g.classList.add("col-sm-4");const f=document.createElement("DIV");f.classList.add("input-group","mb-3");const v=document.createElement("DIV");v.classList.add("input-group-prepend"),v.innerHTML='<span class="input-group-text bg-icono btn pointer"><i class="fa-solid fa-trash text-danger"></i></span>',v.onclick=()=>{var e;e=o,h=h.filter(t=>t.id!=e),a()};const y=document.createElement("INPUT");y.type="text",y.classList.add("form-control"),y.readOnly=!0,y.value=c,y.dataset.productoId=o;const S=document.createElement("DIV");S.classList.add("col-sm-2");const C=document.createElement("DIV");C.classList.add("input-group","mb-3");const T=document.createElement("DIV");T.classList.add("input-group-prepend"),T.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-hashtag text-azul"></i></i></span>';const _=document.createElement("INPUT");_.type="text",_.classList.add("form-control"),_.readOnly=!0,_.value=u,_.dataset.productoId=o,f.appendChild(v),f.appendChild(y),g.appendChild(f),C.appendChild(T),C.appendChild(_),S.appendChild(C);const q=document.createElement("DIV");q.classList.add("col-sm-2");const $=document.createElement("DIV");$.classList.add("input-group","mb-3");const E=document.createElement("DIV");E.classList.add("input-group-prepend"),E.dataset.productoId=o,E.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-hashtag text-azul"></i></i></span>';const x=document.createElement("INPUT");x.type="number",x.classList.add("form-control"),x.value=s,m==o&&1==b&&setTimeout((function(){x.focus()}),0),x.oninput=function(){parseFloat(x.value)>parseFloat(u)?(Swal.fire({icon:"warning",text:"el producto está agotado"}),r(u,o,!0)):r(x.value,o,!0)},$.appendChild(E),$.appendChild(x),q.appendChild($);const w=document.createElement("DIV");w.classList.add("col-sm-2");const L=document.createElement("DIV");L.classList.add("input-group","mb-3");const F=document.createElement("DIV");F.classList.add("input-group-prepend"),F.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-dollar-sign text-azul"></i></i></span>';const D=document.createElement("INPUT");D.type="text",D.classList.add("form-control"),D.value=parseFloat(l).toLocaleString("en"),m==o&&0==b&&setTimeout((function(){D.focus()}),0),D.oninput=()=>{console.log(D.value);const e=i(D.value);D.value=e,r(D.value,o,!1)},D.focus(),L.appendChild(F),L.appendChild(D),w.appendChild(L);const j=document.createElement("DIV");j.classList.add("col-sm-2");const k=document.createElement("DIV");k.classList.add("input-group","mb-3");const N=document.createElement("DIV");N.classList.add("input-group-prepend"),N.dataset.productoId=o,N.innerHTML='<span class="input-group-text bg-icono"> <i class="fas fa-dollar-sign text-azul"></i></i></span>';const P=document.createElement("INPUT");P.type="text",P.readOnly=!0,P.classList.add("form-control"),P.value=parseFloat(d).toLocaleString("en"),k.appendChild(N),k.appendChild(P),j.appendChild(k),p.appendChild(g),p.appendChild(S),p.appendChild(q),p.appendChild(w),p.appendChild(j),e.appendChild(p),n()}),function(){let e=0,t=0,o=0;h.forEach(a=>{e+=a.cantidad*a.precio_original,t+=a.cantidad*a.precio_venta,o+=a.cantidad*a.precio_compra});const a=100-100*t/e;T.value=isNaN(Number(a.toFixed(2)))?"0%":Number(a.toFixed(2))+"%",C.value=e.toLocaleString("en"),_.value=t.toLocaleString("en"),v.total_sin_descuento=e,v.total_pagar=t,v.descuento=isNaN(Number(a.toFixed(2)))?0:Number(a.toFixed(2)),v.costo=o}()}function n(){w.value="",L.value="",F.value="",D.value=v.total_pagar.toLocaleString("en")}function r(e,t,o){if(m=t,o)b=!0,h=h.map(o=>o.id==t?(e<0&&(e=0),{...o,cantidad:e,valor_total:e*o.precio_venta}):o);else{b=!1;let o=parseFloat(e.replace(/,/g,""));h=h.map(a=>a.id==t?(""==e&&(e=0),isNaN(o*a.cantidad)?{...a,precio_venta:0,valor_total:0}:{...a,precio_venta:o,valor_total:o*a.cantidad}):a)}a()}async function c(e){try{const t=await fetch(`${location.origin}/api/producto?id=${e}`),o=await t.json();if(o.stock>0){const{id:e,nombre:t,precio_venta:n,stock:r,precio_compra:c}=o;f={id:e,nombre:t,cantidad:1,precio_compra:c,precio_venta:n,precio_original:parseFloat(n),valor_total:n,stock:r};h.some(t=>t.id==e)?Swal.fire({icon:"warning",text:"el producto ya ha sido agregado anteriormente"}):(h.push(f),a())}else Swal.fire({icon:"error",text:"Producto no disponible en inventario"})}catch(e){}}function i(e){let t=parseFloat(e.replace(/,/g,""));isNaN(t)&&(t="");return t.toLocaleString("en")}function l(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function s(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}async function d(){l(y);try{const e=await fetch(location.origin+"/api/clientes-ventas"),o=await e.json(),a=document.createElement("OPTION");a.textContent="--seleccione un cliente--",a.value="0",o.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.nombre,e.id==g&&(t.selected=!0),y.appendChild(t)}),$("#selectClientes").select2(),$(".select2bs4").select2({theme:"bootstrap4"}),t(g)}catch(e){}$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}!function(){const t=new URL(window.location),o=new URLSearchParams(t.search);1==o.size?(u=atob(o.get("id")),async function(){const e=`${location.origin}/api/venta?id=${u}`;try{const t=await fetch(e);!function(e){g=e.cliente_id;const t=e.productos_venta,o=e.venta;z.value=o.codigo;let n=0;t.forEach(e=>{f={id:e.id,nombre:e.nombre,cantidad:e.cantidad,precio_compra:e.precio_compra,precio_venta:e.precio_factura,precio_original:e.precio_venta,valor_total:e.precio_factura*e.cantidad,stock:parseFloat(e.stock)+parseFloat(e.cantidad)},n=parseFloat(n)+parseFloat(e.precio_venta)*e.cantidad,h.push(f)}),a(),C.value=n.toLocaleString("en"),T.value=e.venta.descuento+"%",_.value=parseFloat(e.venta.total_factura).toLocaleString("en"),(""!=o.nombre_cliente||""!=o.cedula_cliente||""!=o.celular_cliente||""!=o.direccion_cliente||null!=o.nombre)&&(M.classList.remove("d-none"),j.value=o.nombre_cliente,k.value=o.cedula_cliente,N.value=o.celular_cliente,P.value=o.direccion_cliente,O.value=o.email_cliente);if(2==o.metodo_pago||3==o.metodo_pago){let e="";e=2==o.metodo_pago?document.querySelector('#metodo_pago option[value="2"]'):document.querySelector('#metodo_pago option[value="3"]'),e.selected=!0,F.value=parseFloat(o.recaudo).toLocaleString("en"),D.value=(o.total_factura-o.recaudo).toLocaleString("en"),E.classList.add("d-none"),x.classList.remove("d-none")}}(await t.json())}catch(e){}}(),d()):(e(),d())}(),async function(){try{const e=await fetch(location.origin+"/api/productos-ventas"),t=await e.json();p=t,function(e){B.addEventListener("input",(function(t){t.preventDefault();const o=t.target.value;if(/[^0-9]/.test(o))B.addEventListener("keydown",t=>{if(13==t.keyCode){const o=e.filter(e=>e.codigo.toLowerCase()==t.target.value.toLowerCase());o.length>0&&(c(o[0].id),t.target.value="")}});else{const o=e.filter(e=>e.codigo.toLowerCase()==t.target.value.toLowerCase());o.length>0&&(c(o[0].id),t.target.value="")}}))}(p);const o=document.createElement("OPTION");o.textContent="--seleccione un producto--",o.value="0",A.appendChild(o),t.forEach(e=>{const t=document.createElement("OPTION");t.value=e.id,t.textContent=e.nombre,A.appendChild(t)}),$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}catch(e){}$("#selectProductos").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}(),S.addEventListener("click",(function(){!function(){if(0==h.length)return void Swal.fire({icon:"error",text:"No Hay productos agregados a esta venta"});if(2==q.value&&0==y.value)return void Swal.fire({icon:"error",text:"Para las ventas a credito o de mercado libre es necesario seleccionar un cliente que se encuentre registrado"});!async function(){console.log(v);const t=new FormData;u&&t.append("id",u);t.append("productosArray",JSON.stringify(h)),t.append("total_factura",v.total_pagar),t.append("total",v.total_sin_descuento),t.append("costo",v.costo),t.append("descuento",v.descuento),t.append("metodo_pago",q.value),1!=q.value?(valor_abono=0,""!=F.value&&(valor_abono=F.value),t.append("abono",valor_abono),t.append("saldo",D.value),t.append("cliente_id",y.value),t.append("recaudo",valor_abono),parseFloat(valor_abono)<parseFloat(v.total_pagar)?t.append("pagado",0):t.append("pagado",1)):(t.append("pagado",1),t.append("recaudo",v.total_pagar));let n;t.append("nombre_cliente",j.value),t.append("cedula_cliente",k.value),t.append("celular_cliente",N.value),t.append("direccion_cliente",P.value),t.append("email_cliente",O.value),n=u?location.origin+"/api/editar-venta":location.origin+"/api/crear-venta";try{const r=await fetch(n,{method:"POST",body:t}),c=await r.json();console.log(c),s(),"error"==c.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:c.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:c.msg}),function(){u=null,h=[],f={id:"",nombre:"",cantidad:"",precio_compra:"",precio_venta:"",precio_original:"",valor_total:"",stock:""},v={total_sin_descuento:"",total_pagar:"",descuento:"",costo:""};const t=$("#selectProductos"),n=$("#selectClientes");t.val("0").trigger("change.select2"),n.val("0").trigger("change.select2"),q.innerHTML='\n                <option value="1">Pago e Contado</option>\n                <option value="2">Pago a Cuotas</option>\n                <option value="3">Mercado Libre</option>\n            ',w.value="",L.value="",F.value="",D.value="",M.classList.contains("d-none")||M.classList.add("d-none");const r=document.querySelector("#pago-contado"),c=document.querySelector("#pago-cuotas");c.classList.contains("d-none")||c.classList.add("d-none");r.classList.contains("d-none")&&r.classList.remove("d-none");e(),o(),a()}()),S.disabled=!1,setTimeout(()=>{s()},8e3)}catch(e){console.log(e)}}()}()})),q.addEventListener("change",(function(){M.classList.contains("d-none")&&M.classList.remove("d-none"),E.classList.contains("d-none")&&E.classList.remove("d-none"),x.classList.contains("d-none")&&x.classList.remove("d-none"),1!=q.value?(F.value="",D.value=v.total_pagar.toLocaleString("en"),o(),j.readOnly=!0,k.readOnly=!0,N.readOnly=!0,P.readOnly=!0,O.readOnly=!0,R.disabled=!0,E.classList.add("d-none")):(g=null,j.readOnly=!1,k.readOnly=!1,N.readOnly=!1,P.readOnly=!1,O.readOnly=!1,R.disabled=!1,M.classList.add("d-none"),x.classList.add("d-none"))})),I.addEventListener("click",(function(){M.classList.contains("d-none")&&M.classList.remove("d-none")})),R.addEventListener("click",(function(){o(),M.classList.add("d-none")})),w.addEventListener("input",(function(e){w.value=i(e.target.value);const t=parseFloat(w.value.replace(/,/g,""))-v.total_pagar;L.value=t.toLocaleString("en")})),F.addEventListener("input",(function(e){F.value=i(e.target.value);const t=parseFloat(F.value.replace(/,/g,"")),o=v.total_pagar-t;D.value=o.toLocaleString("en")})),_.addEventListener("input",(function(e){if(0==h.length)return void(_.value=0);_.value=i(e.target.value);const t=parseFloat(_.value.replace(/,/g,""));let o=0;h.forEach(e=>{o+=e.cantidad*e.precio_original});const a=100-100*t/o;T.value=isNaN(Number(a.toFixed(2)))?"0%":Number(a.toFixed(2))+"%",v.total_pagar=t,v.descuento=a,n()})),$("#selectProductos").on("select2:select",(function(e){c(e.target.value)})),$("#selectClientes").on("select2:select",(function(e){0!=e.target.value?t(e.target.value):o()}))}}(),function(){const e=document.querySelector("#mercadolibre"),t=document.querySelector("#ventas");if(e||t){$("#tabla").on("click","#info",(function(e){!async function(e){$("#modal-info").modal("show");const t=`${location.origin}/api/venta?id=${e}`;try{const e=await fetch(t);!function(e){const{productos_venta:t,venta:o}=e,a=document.querySelector("#codigo-venta"),n=document.querySelector("#cliente-venta"),r=document.querySelector("#fecha-venta"),c=document.querySelector("#total-venta"),i=document.querySelector("#total"),l=document.querySelector("#total-sin-descuento"),s=document.querySelector("#recaudo-venta"),d=document.querySelector("#saldo-venta"),u=document.querySelector("#metodo-venta"),m=document.querySelector("#estado-venta");a.textContent=o.codigo,n.textContent=o.nombre_cliente,r.textContent=o.fecha,c.textContent=parseFloat(o.total_factura).toLocaleString("en"),i.textContent=parseFloat(o.total).toLocaleString("en"),l.textContent=parseFloat(o.descuento).toLocaleString("en")+"%",s.textContent=parseFloat(o.recaudo).toLocaleString("en"),d.textContent=parseFloat(o.total_factura-o.recaudo).toLocaleString("en"),2==o.metodo_pago&&(u.textContent="Fiado");1==o.metodo_pago&&(u.textContent="De Contado");m.classList.contains("text-danger")&&m.classList.remove("text-danger");m.classList.contains("text-success")&&m.classList.remove("text-success");0==o.pagado?(m.textContent="Pendiente",m.classList.add("text-danger")):(m.textContent="Pagado",m.classList.add("text-success"));const p=document.querySelector("#body-productos-venta");(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})(p),t.forEach(e=>{const{nombre:t,cantidad:o,precio_factura:a}=e,n=document.createElement("TR"),r=document.createElement("td");r.textContent=t;const c=document.createElement("td");c.textContent=o;const i=document.createElement("td");i.textContent=parseFloat(a).toLocaleString("en");const l=document.createElement("td");l.textContent=parseFloat(a*o).toLocaleString("en"),n.appendChild(r),n.appendChild(c),n.appendChild(i),n.appendChild(l),p.appendChild(n)})}(await e.json())}catch(e){}}(e.currentTarget.dataset.ventaId)}))}}(),function(){if(document.querySelector("#reportes"));}(),function(){if(document.querySelector("#reporte")){const t=document.querySelector("#reporte_total_ventas"),o=document.querySelector("#reporte_total_recaudos"),a=document.querySelector("#reporte_costos"),n=document.querySelector("#reporte_ganancia_no_realizada"),r=document.querySelector("#reporte_ganancia_realizada"),c=document.querySelector("#reporte_inventario"),i=document.querySelector("#reporte_numero_ventas"),l=document.querySelector("#reporte_numero_fiados"),s=document.querySelector("#reporte_numero_pagos"),d=document.querySelector("#reporte_numero_cajas"),u=document.querySelector("#reporte_numero_productos"),m=document.querySelector("#reporte_numero_clientes"),p=document.querySelector("#fecha");async function e(e){const p=new FormData;p.append("fecha",e);const g=location.origin+"/api/info-general";try{const e=await fetch(g,{method:"POST",body:p}),f=await e.json();console.log(f),function(e){console.log("asdf"),console.log(e),t.textContent=e.total_ventas,o.textContent=e.total_recaudos,a.textContent=e.costos,n.textContent=e.ganancia_no_realizada,r.textContent=e.ganancia_realizada,c.textContent=e.inventario,i.textContent=e.numero_ventas,l.textContent=e.numero_fiados,s.textContent=e.numero_pagos,d.textContent=e.numero_cajas,u.textContent=e.numero_productos,m.textContent=e.numero_clientes}(f)}catch(e){console.log(e)}}p.addEventListener("input",(function(t){e(t.target.value)})),function(){const t=new Date,o=new Date(t.getTime()-18e6).toISOString().slice(0,10);p.value=o,e(p.value)}()}}(),function(){if(document.querySelector("#ventas")){let t;function e(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}$("#tabla").on("click","#editar",(function(t){id=t.currentTarget.dataset.ventaId,async function(t){const o=new FormData;o.append("id",t);const a=location.origin+"/api/revisar-venta";try{const n=await fetch(a,{method:"POST",body:o}),r=await n.json();if(e(),"error"==r.type)$(document).Toasts("create",{class:"bg-danger",title:"Error",body:r.msg});else{const e=t.toString();window.location="/crear-venta?id="+btoa(e)}setTimeout(()=>{e()},8e3)}catch(e){console.log(e)}}(id)})),$("#tabla").on("click","#eliminar",(function(o){!function(o,a){const n=a.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar la venta numero <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&async function(o){const a=new FormData;a.append("id",o),url=location.origin+"/api/venta/eliminar";try{const o=await fetch(url,{body:a,method:"POST"}),n=await o.json();e(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{e()},8e3),t.ajax.reload())}catch(e){}}(o)})}(o.currentTarget.dataset.ventaId,o)})),$("#tabla").on("click","#imprimir",(function(e){!async function(e){(new FormData).append("id",e);const t=`${location.origin}/api/imprimir-venta?id=${e}`;window.open(t,"_blank")}(e.currentTarget.dataset.ventaId)})),function(){$.fn.DataTable.isDataTable("#tabla")&&$("#tabla").DataTable().destroy();t=$("#tabla").DataTable({processing:!0,serverSide:!0,ajax:{url:"/api/ventas",type:"GET"},responsive:!0,order:[[1,"desc"]],language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ Entradas",infoEmpty:"Mostrando 0 a 0 de 0 Entradas",infoFiltered:"(filtrado de _MAX_ entradas totales)",lengthMenu:"Mostrar _MENU_ Entradas",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"No se encontraron resultados",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"}}})}()}}();
//# sourceMappingURL=bundle.js.map
